<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <title>Schedule Table</title>
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <!-- Bootstrap optional (for nicer modal/buttons). Remove if you want pure CSS. -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet"/>
    <style>
        body { background:#f9fafb; }
        .container-narrow { max-width: 900px; }
        .table thead th { background:#f1f5f9; }
        .subrow td { font-size: 0.925rem; color:#475569; border-top:0; padding-top:0; padding-bottom:0.75rem;}
        .mainrow td { border-bottom:0; }
        .empty-row td { text-align:center; color:#64748b; font-style:italic; }
        .btn-circle { width:2rem; height:2rem; padding:0; border-radius:50%; display:inline-flex; align-items:center; justify-content:center; }
        .divider { height:1px; background:#e5e7eb; margin:0.25rem 0 0.75rem 0; }
    </style>
</head>
<body>
<div class="container container-narrow py-4">
    <div class="d-flex justify-content-between align-items-center mb-3">
        <h4 class="m-0">Schedules</h4>
        <button id="openAddModal" class="btn btn-primary">Add Schedule</button>
    </div>

    <div class="table-responsive">
        <table class="table table-bordered align-middle">
            <thead>
            <tr>
                <th style="width:30%">Date / Day</th>
                <th style="width:25%">Start Time</th>
                <th style="width:25%">End Time</th>
                <th style="width:20%">Action</th>
            </tr>
            </thead>
            <tbody id="scheduleBody">
            <tr class="empty-row">
                <td colspan="4">No Schedule at the current</td>
            </tr>
            </tbody>
        </table>
    </div>

    <!-- Add another button at bottom (like your mockup) -->
    <div class="text-center mt-3">
        <button id="openAddModalBottom" class="btn btn-primary">Add Schedule</button>
    </div>
</div>

<!-- Add Schedule Modal -->
<div class="modal fade" id="addScheduleModal" tabindex="-1" aria-labelledby="addScheduleLabel" aria-hidden="true">
    <div class="modal-dialog">
        <form class="modal-content" id="addScheduleForm">
            <div class="modal-header">
                <h5 class="modal-title" id="addScheduleLabel">Add Schedule</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>

            <div class="modal-body">
                <div class="mb-3">
                    <label class="form-label" for="dateInput">Date</label>
                    <input type="date" id="dateInput" class="form-control" required />
                </div>
                <div class="row g-3">
                    <div class="col-md-6">
                        <label class="form-label" for="startInput">Start Time</label>
                        <input type="time" id="startInput" class="form-control" required />
                    </div>
                    <div class="col-md-6">
                        <label class="form-label" for="endInput">End Time</label>
                        <input type="time" id="endInput" class="form-control" required />
                    </div>
                </div>
                <div class="form-text mt-2">
                    Overlapping slots on the same date are not allowed.
                </div>
            </div>

            <div class="modal-footer">
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">Cancel</button>
                <button type="submit" class="btn btn-success">Add</button>
            </div>
        </form>
    </div>
</div>

<!-- Bootstrap JS (optional for modal) -->
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>

<script>
    // ===== Utilities =====
    function toDayName(dateStr) {
      const d = new Date(dateStr + "T00:00:00");
      return d.toLocaleDateString(undefined, { weekday: "long" });
    }

    function toPrettyDate(dateStr) {
      const d = new Date(dateStr + "T00:00:00");
      return d.toLocaleDateString(undefined, { month: "short", day: "numeric", year: "numeric" });
    }

    function toAmPm(timeStr) {
      // timeStr = "HH:MM"
      const [hStr, mStr] = timeStr.split(":");
      let h = parseInt(hStr, 10);
      const m = parseInt(mStr, 10);
      const suffix = h >= 12 ? "PM" : "AM";
      h = h % 12;
      if (h === 0) h = 12;
      const mm = String(m).padStart(2, "0");
      return `${String(h).padStart(2,"0")}:${mm} ${suffix}`;
    }

    function cmpDate(a, b) {
      if (a.date < b.date) return -1;
      if (a.date > b.date) return 1;
      // tie-breaker by start time
      if (a.start < b.start) return -1;
      if (a.start > b.start) return 1;
      // then end time
      if (a.end < b.end) return -1;
      if (a.end > b.end) return 1;
      return 0;
    }

    function overlaps(aStart, aEnd, bStart, bEnd) {
      // HH:MM strings; overlap if intervals intersect (not just touch)
      return aStart < bEnd && bStart < aEnd;
    }

    // ===== State =====
    const schedules = []; // { id, date: "YYYY-MM-DD", start: "HH:MM", end: "HH:MM" }

    // ===== DOM =====
    const scheduleBody = document.getElementById("scheduleBody");
    const openAddModalBtn = document.getElementById("openAddModal");
    const openAddModalBottomBtn = document.getElementById("openAddModalBottom");
    const addModalEl = document.getElementById("addScheduleModal");
    const addModal = new bootstrap.Modal(addModalEl);
    const addForm = document.getElementById("addScheduleForm");
    const dateInput = document.getElementById("dateInput");
    const startInput = document.getElementById("startInput");
    const endInput = document.getElementById("endInput");

    openAddModalBtn.addEventListener("click", () => {
      addForm.reset();
      addModal.show();
      setTimeout(() => dateInput.focus(), 50);
    });
    openAddModalBottomBtn.addEventListener("click", () => {
      addForm.reset();
      addModal.show();
      setTimeout(() => dateInput.focus(), 50);
    });

    // ===== Render =====
    function render() {
      scheduleBody.innerHTML = "";

      if (schedules.length === 0) {
        const tr = document.createElement("tr");
        tr.className = "empty-row";
        tr.innerHTML = `<td colspan="4">No Schedule at the current</td>`;
        scheduleBody.appendChild(tr);
        return;
      }

      // sort then render
      schedules.sort(cmpDate);

      schedules.forEach(item => {
        const dayName = toDayName(item.date);
        const prettyDate = toPrettyDate(item.date);
        const start = toAmPm(item.start);
        const end = toAmPm(item.end);

        // Main line (Day | Start | End | Action)
        const tr1 = document.createElement("tr");
        tr1.className = "mainrow";
        tr1.innerHTML = `
          <td><strong>${dayName}</strong></td>
          <td>${start}</td>
          <td>${end}</td>
          <td>
            <button class="btn btn-outline-danger btn-circle btn-sm" title="Remove" data-id="${item.id}">X</button>
          </td>
        `;

        // Sub line: full date
        const tr2 = document.createElement("tr");
        tr2.className = "subrow";
        tr2.innerHTML = `
          <td>${prettyDate}</td>
          <td></td>
          <td></td>
          <td></td>
        `;

        scheduleBody.appendChild(tr1);
        scheduleBody.appendChild(tr2);

        // Divider (optional, to mimic your separator lines)
        const trDiv = document.createElement("tr");
        const tdDiv = document.createElement("td");
        tdDiv.colSpan = 4;
        tdDiv.innerHTML = `<div class="divider"></div>`;
        trDiv.appendChild(tdDiv);
        scheduleBody.appendChild(trDiv);
      });
    }

    // ===== Add / Delete logic =====
    addForm.addEventListener("submit", (e) => {
      e.preventDefault();
      const date = (dateInput.value || "").trim();         // "YYYY-MM-DD"
      const start = (startInput.value || "").trim();       // "HH:MM"
      const end = (endInput.value || "").trim();           // "HH:MM"

      if (!date || !start || !end) {
        alert("Please select date, start time and end time.");
        return;
      }
      if (end <= start) {
        alert("End time must be after start time.");
        return;
      }

      // prevent overlap on the same date
      const sameDate = schedules.filter(s => s.date === date);
      const hasOverlap = sameDate.some(s => overlaps(start, end, s.start, s.end));
      if (hasOverlap) {
        alert("This time overlaps an existing slot for the same date.");
        return;
      }

      schedules.push({
        id: crypto.randomUUID ? crypto.randomUUID() : String(Date.now() + Math.random()),
        date, start, end
      });

      addModal.hide();
      render();
    });

    scheduleBody.addEventListener("click", (e) => {
      const btn = e.target.closest("button[data-id]");
      if (!btn) return;
      const id = btn.getAttribute("data-id");
      const idx = schedules.findIndex(s => s.id === id);
      if (idx !== -1) {
        schedules.splice(idx, 1);
        render();
      }
    });

    // Initial
    render();
</script>
</body>
</html>
