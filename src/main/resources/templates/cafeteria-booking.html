<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<head th:replace="~{event-registration :: head}"></head>

<body class="event-list">

<div th:replace="~{fragments/header :: header}"></div>

<main class="main" style="padding-bottom: 50px;">

    <div class="page-title dark-background" data-aos="fade" th:style="'background-image: url(' + @{/images/Join_Event.png} + ');'">
        <div class="container position-relative text-center">
            <h1 class="display-4 fw-bold">Cafeteria Booking</h1>
        </div>
    </div>

    <div class="container my-5">
        <!-- Info Table -->
        <table class="table table-bordered schedule-table shadow-sm rounded"> <!--w-auto mx-auto mb-5-->
            <tbody>
            <thead>
            <tr>
                <th scope="col" style="width: 200px; text-align: left;">Incharge Person</th>
                <td th:text="${planner.incharge_person}" style="text-align: left;"></td>
            </tr>
            <tr>
                <th scope="col" style="width: 200px; text-align: left;">Supported Members</th>
                <td th:text="${planner.supported_members ?: 'No supported members yet'}" style="text-align: left;"></td>
            </tr>
            </thead>
            </tbody>
        </table>

        <div class="d-flex justify-content-between align-items-center m-3">
            <div>
                <p class="mb-0">There are <span id="count"></span> <span id="activity-text"></span>.</p>
            </div>
            <div class="d-flex justify-content-between align-items-center">
                <div>
                    <input class="form-control" name="keyword" id="search" placeholder="Search ...">
                </div>
            </div>
        </div>

        <table class="table table-hover table-bordered schedule-table shadow-sm rounded">
            <input type="hidden" th:value="${planner.eventId}" name="eventId" id="eventId">
            <input type="hidden" th:value="${planner.eventName}" name="eventName" id="eventName">
            <thead>
            <tr>
                <th scope="col">No. </th>
                <th scope="col">Event</th>
                <th scope="col">Schedule</th>
                <th scope="col">Book</th>
            </tr>
            </thead>
            <tbody id="scheduleTableBody">

            </tbody>
        </table>

        <nav aria-label="Staff pagination">
            <ul class="pagination justify-content-center" id="pagination"></ul>
        </nav>


    </div>

    <!-- Cafeteria Usage Form Modal -->
    <div class="modal fade" id="scheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" style="max-width: 60%; width: auto;">
            <div class="modal-content" style="height: 50rem;">
                <div class="modal-header">
                    <h5 class="modal-title" id="scheduleModalLabel">Cafeteria Usage Form For - <span th:text="${planner.eventName}"></span> </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body" id="modalBody">
                    <div class="mb-3 row">
                        <label for="applicantName" class="col-sm-4 col-form-label">Applicant Name <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="applicantName" name="applicantName" readonly required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="applicantStaffId" class="col-sm-4 col-form-label">Applicant Staff ID <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="applicantStaffId" name="applicantStaffId" readonly required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="team" class="col-sm-4 col-form-label">Team <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="team" name="team" readonly required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="department" class="col-sm-4 col-form-label">Department <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="department" name="department" readonly required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="preferredDate" class="col-sm-4 col-form-label">
                            Preferred Date <span class="text-danger">*</span>
                        </label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="preferredDate" name="preferredDate" readonly>
                            <div class="text-danger mt-1 text-error" id="dateError" style="display:none;">
                                Duration must not be over 5 Hours!
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">
                            Preferred Time<br>
                            <small class="text-muted">(including setup and cleanup duration)</small>
                        </label>
                        <div class="col-sm-8">
                            <ul>
                                <li>If Weekday, 9:00AM to 7:00PM, Except Lunch (11:00AM to 1:00PM).</li>
                                <li>If Weekend, 9:00AM to 7:00PM.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="attendees" class="col-sm-4 col-form-label">
                            Expected Attendees <span class="text-danger">*</span>
                        </label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="attendees" name="attendees" placeholder="Minimum 5 & Maximum 60">
                            <div class="text-danger mt-1 text-error" id="attendeeError" style="display:none;">

                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="accessories" class="col-sm-4 col-form-label">
                            Requested Accessories
                        </label>
                        <div class="col-sm-8">
                            <select id="accessories" name="accessories[]" class="form-select">
                                <option value="">Select Accessory</option>
                                <option th:each="accessory : ${accessories}"
                                        th:value="${accessory.id}"
                                        th:text="${accessory.name}">
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-sm-4"></div>
                        <div class="col-sm-8">
                            <div id="selectedAccessories" class="row g-2"></div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="purpose" class="col-sm-4 col-form-label">
                            Purpose of the Event <span class="text-danger">*</span>
                        </label>
                        <div class="col-sm-8">
                            <textarea class="form-control" id="purpose" name="purpose" rows="3" maxlength="255"></textarea>
                            <div class="text-danger mt-1 text-error" id="purposeError" style="display:none;">
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-sm-12">
                            <h6 class="fw-bold">Employee Pledge</h6>

                            <p class="mb-1 fw-bold">I acknowledge that I agree to:</p>
                            <ul class="mb-3">
                                <li>Comply with all booking, usage, and conduct requirements and Rule &amp; Regulations.</li>
                                <li>Ensure that any damages, violations, or misconduct caused by myself or my team during cafeteria use will be reported immediately and may be subject to accountability measures.</li>
                            </ul>

                            <p class="mb-1 fw-bold">I understand that:</p>
                            <ul>
                                <li>Failure to comply with these rules may result in cancellation of the event, denial of future bookings, or other administrative actions.</li>
                                <li>The Admin/HR Department reserves the right to reschedule or cancel bookings in line with company priorities.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="mb-3 row align-items-center">
                        <div class="col-sm-7"></div>
                        <label class="col-sm-2 col-form-label text-danger">Applicant Signature <span class="text-danger">*</span></label>
                        <div class="col-sm-3">
                            <div class="d-flex align-items-center mb-1">
                                <input type="file" class="form-control d-none" id="signature" name="signature" accept="image/*">

                                <a href="#" id="uploadSignatureLink" class="text-primary me-2" style="text-decoration: underline;">Sign Here</a>

                                <img id="signaturePreview" src="" alt="Signature Preview"
                                     style="max-width: 120px; max-height: 60px; display: none; border: 1px solid #ccc; padding: 2px; border-radius: 4px;">
                            </div>
                            <div class="text-danger mt-1 text-error" id="signError" style="display:none;">
                                Signature Required!
                            </div>
                        </div>
                    </div>


                    <div class="mb-3 row align-items-center">
                        <div class="col-sm-7"></div>
                        <label class="col-sm-2 col-form-label text-danger">Signed Date <span class="text-danger">*</span></label>
                        <div class="col-sm-3">
                            <input type="date" class="form-control" id="signedDate" name="signedDate" readonly>
                        </div>
                    </div>
                </div>
                <input type="hidden" name="scheduleId" id="scheduleId">
                <div class="modal-footer">
                    <button type="reset" class="btn cancel" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn confirm" id="saveBtn">Save</button>
                    <button type="submit" class="btn confirm" id="saveContinueBtn">Save & Continue</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Cafeteria Usage Form -->

    <!-- Edit Cafeteria Usage Form Modal -->
    <div class="modal fade" id="editScheduleModal" tabindex="-1" aria-labelledby="scheduleModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-dialog-centered modal-dialog-scrollable" style="max-width: 60%; width: auto;">
            <div class="modal-content" style="height: 50rem;">
                <div class="modal-header">
                    <h5 class="modal-title" id="editScheduleModalLabel">Edit Cafeteria Usage Form For - <span th:text="${planner.eventName}"></span> </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>

                <div class="modal-body" id="editModalBody">
                    <div class="mb-3 row">
                        <label for="applicantName" class="col-sm-4 col-form-label">Applicant Name <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="editApplicantName" name="applicantName" readonly required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="applicantStaffId" class="col-sm-4 col-form-label">Applicant Staff ID <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="editApplicantStaffId" name="applicantStaffId" readonly required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="team" class="col-sm-4 col-form-label">Team <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="editTeam" name="team" readonly required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="department" class="col-sm-4 col-form-label">Department <span class="text-danger">*</span></label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="editDepartment" name="department" readonly required>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="preferredDate" class="col-sm-4 col-form-label">
                            Preferred Date <span class="text-danger">*</span>
                        </label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="editPreferredDate" name="preferredDate" readonly>
                            <div class="text-danger mt-1 text-error" id="editDateError" style="display:none;">
                                Duration must not be over 5 Hours!
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label class="col-sm-4 col-form-label">
                            Preferred Time<br>
                            <small class="text-muted">(including setup and cleanup duration)</small>
                        </label>
                        <div class="col-sm-8">
                            <ul>
                                <li>If Weekday, 9:00AM to 7:00PM, Except Lunch (11:00AM to 1:00PM).</li>
                                <li>If Weekend, 9:00AM to 7:00PM.</li>
                            </ul>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="attendees" class="col-sm-4 col-form-label">
                            Expected Attendees <span class="text-danger">*</span>
                        </label>
                        <div class="col-sm-8">
                            <input type="text" class="form-control" id="editAttendees" name="attendees" placeholder="Minimum 5 & Maximum 60">
                            <div class="text-danger mt-1 text-error" id="editAttendeeError" style="display:none;">

                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="accessories" class="col-sm-4 col-form-label">
                            Requested Accessories
                        </label>
                        <div class="col-sm-8">
                            <select id="editAccessories" name="accessories[]" class="form-select">
                                <option value="">Select Accessory</option>
                                <option th:each="accessory : ${accessories}"
                                        th:value="${accessory.id}"
                                        th:text="${accessory.name}">
                                </option>
                            </select>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-sm-4"></div>
                        <div class="col-sm-8">
                            <div id="editSelectedAccessories" class="row g-2"></div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <label for="purpose" class="col-sm-4 col-form-label">
                            Purpose of the Event <span class="text-danger">*</span>
                        </label>
                        <div class="col-sm-8">
                            <textarea class="form-control" id="editPurpose" name="purpose" rows="3" maxlength="255"></textarea>
                            <div class="text-danger mt-1 text-error" id="editPurposeError" style="display:none;">
                            </div>
                        </div>
                    </div>

                    <div class="mb-3 row">
                        <div class="col-sm-12">
                            <h6 class="fw-bold">Employee Pledge</h6>

                            <p class="mb-1 fw-bold">I acknowledge that I agree to:</p>
                            <ul class="mb-3">
                                <li>Comply with all booking, usage, and conduct requirements and Rule &amp; Regulations.</li>
                                <li>Ensure that any damages, violations, or misconduct caused by myself or my team during cafeteria use will be reported immediately and may be subject to accountability measures.</li>
                            </ul>

                            <p class="mb-1 fw-bold">I understand that:</p>
                            <ul>
                                <li>Failure to comply with these rules may result in cancellation of the event, denial of future bookings, or other administrative actions.</li>
                                <li>The Admin/HR Department reserves the right to reschedule or cancel bookings in line with company priorities.</li>
                            </ul>
                        </div>
                    </div>

                    <!--<div class="mb-3 row align-items-center">
                        <div class="col-sm-7"></div>
                        <label class="col-sm-2 col-form-label text-danger">Applicant Signature <span class="text-danger">*</span></label>
                        <div class="col-sm-3">
                            <div class="d-flex align-items-center mb-1">
                                <input type="file" class="form-control d-none" id="signature" name="signature" accept="image/*">

                                <a href="#" id="uploadSignatureLink" class="text-primary me-2" style="text-decoration: underline;">Sign Here</a>

                                <img id="signaturePreview" src="" alt="Signature Preview"
                                     style="max-width: 120px; max-height: 60px; display: none; border: 1px solid #ccc; padding: 2px; border-radius: 4px;">
                            </div>
                            <div class="text-danger mt-1 text-error" id="EditSignError" style="display:none;">
                                Signature Required!
                            </div>
                        </div>
                    </div>-->


                    <div class="mb-3 row align-items-center">
                        <div class="col-sm-7"></div>
                        <label class="col-sm-2 col-form-label text-danger">Signed Date <span class="text-danger">*</span></label>
                        <div class="col-sm-3">
                            <input type="date" class="form-control" id="editSignedDate" name="signedDate" readonly>
                        </div>
                    </div>
                </div>
                <input type="hidden" name="scheduleId" id="editScheduleId">
                <div class="modal-footer">
                    <button type="reset" class="btn cancel" data-bs-dismiss="modal">Cancel</button>
                    <button type="submit" class="btn confirm" id="editBtn">Edit</button>
                    <button type="submit" class="btn confirm" id="editContinueBtn">Edit & Continue</button>
                </div>
            </div>
        </div>
    </div>
    <!-- Edit Cafeteria Usage Form Modal -->

</main>

<div id="preloader"></div>

<!-- Vendor JS Files -->
<script th:src="@{/assets/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
<!-- toast -->
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/toast.min.js}"></script>
<script th:src="@{/js/toast-config.js}"></script>
<!-- toast -->
<div th:replace="~{fragments/footer :: footer}"></div>
<script th:src="@{/js/cafeteria-booking.js}"></script>

<!-- Main JS File -->
<script th:src="@{/assets/js/main.js}"></script>

<script>
    const scheduleUrl = '[[@{${WebUrl.CAFETERIA_BOOKING_URL}}]]';
    const checkBooked = '[[@{${WebUrl.CHECK_BOOKED_URL}}]]';
    const bookingUrl = '[[@{${WebUrl.CAFETERIA_BOOKING_POST_URL}}]]';

    const currentStaffName = '[[@{${StaffName}}]]';
    const currentStaffNo = '[[@{${StaffNo}}]]';
    const currentTeam = '[[@{${Team}}]]';
    const currentDepartment = '[[@{${Department}}]]';
</script>
</body>
</html>
