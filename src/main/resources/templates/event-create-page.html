<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<head th:fragment="head">
    <meta charset="UTF-8"/>
    <title>Event Planner</title>
    <link rel="icon" th:href="@{/images/DAT Logo.png}">
    <link th:href="@{/assets/vendor/bootstrap-icons/bootstrap-icons.css}" rel="stylesheet"/>
    <link th:href="@{/css/bootstrap.min.css}" rel="stylesheet">
    <link th:href="@{/css/event-calendar.css}" rel="stylesheet"/>
    <link th:href="@{/assets/css/main.css}" rel="stylesheet"/>
    <link th:href="@{/css/footer.css}" rel="stylesheet"/>
    <link rel="stylesheet" th:href="@{/css/main.css}"/>
</head>
<body class="registration">

<div th:replace="~{fragments/header :: header}"></div>

<main class="main" style="padding-bottom: 50px;">

    <!-- Page Title -->
    <div class="page-title dark-background" data-aos="fade"
         style="background-image: url(./images/event_list.png);">
        <div class="position-relative">
            <h1>Event Registration</h1>
        </div>
    </div>

    <div class="container my-5">
        <div class="wizard-nav">
            <div id="navStep1" class="wizard-step-link active" onclick="goToStep(1)">
                <span class="step-number">1</span> Event Details
            </div>
            <div id="navStep2" class="wizard-step-link" onclick="goToStep(2)">
                <span class="step-number">2</span> Event Schedules
            </div>
        </div>

        <form id="eventForm" novalidate>
            <div id="wizard">
                <!-- Step 1: Event Details -->
                <div class="wizard-step active" id="step1">
                    <div class="mb-3">
                        <label for="eventName" class="form-label">Event Name <span class="text-danger">*</span></label>
                        <input class="form-control" id="eventName" name="eventName" placeholder="Enter Event Name"
                               required type="text"/>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="photoLabel">Event Photo<span class="text-danger">*</span></label>
                        <div class="col d-flex align-items-center">
                            <label class="btn confirm form-label m-0" id="photoLabel"
                                   for="eventPhoto"
                                   style="background-color: var(--accent-2); border-radius: var(--bs-border-radius) 0 0 var(--bs-border-radius); color: white; width: 200px;">
                                <span>
                                    Choose Photo
                                    <i class="bi ms-1 bi-upload"></i>
                                </span>
                            </label>
                            <span class="btn cancel flex-grow-1" id="fileName"
                                  style="border-radius: 0 var(--bs-border-radius) var(--bs-border-radius) 0; margin-left: 5px;">
                                No photo selected.
                            </span>
                        </div>
                        <input accept="image/*" class="form-control" hidden id="eventPhoto" name="eventPhoto"
                               onchange="
                               const file = this.files[0];
                               if (file) {
                                    document.getElementById('fileName').textContent = file.name;
                               }" required type="file"/>
                    </div>
                    <div class="mb-3">
                        <label for="eventDesc" class="form-label">Description</label>
                        <textarea class="form-control" id="eventDesc" name="eventDesc"
                                  placeholder="Optional description"
                                  rows="3"></textarea>
                    </div>

                    <div class="mb-3">
                        <label class="form-label" for="inchargePerson">Incharge Person <span
                                class="text-danger">*</span></label>
                        <div class="input-group">
                            <input class="form-control" data-bs-target="#personModal" data-bs-toggle="modal" data-id=""
                                   id="inchargePerson"
                                   name="inchargePerson"
                                   placeholder="Select person" readonly required type="text"/>
                        </div>
                        <div class="text-danger mt-1" id="inchargePersonError" style="display:none;">Please select an
                            incharge person.
                        </div>
                    </div>

                    <div class="mb-3">
                        <button class="btn confirm" data-bs-target="#memberModal" data-bs-toggle="modal"
                                type="button">Add Supported Member
                        </button>
                    </div>

                    <div class="table-responsive">
                        <table class="table table-bordered">
                            <thead>
                            <tr>
                                <th class="align-middle">No.</th>
                                <th class="align-middle">Member</th>
                                <th class="align-middle">Month</th>
                                <th class="align-middle">Action</th>
                            </tr>
                            </thead>
                            <tbody id="supportedList"></tbody>
                        </table>
                    </div>

                    <div class="text-end">
                        <button class="btn confirm" onclick="goToStep(2)" style="width: 125px;" type="button">Next
                        </button>
                    </div>
                </div>

                <!-- Incharge Person Modal -->
                <div aria-labelledby="personModalLabel" class="modal fade" id="personModal" tabindex="-1"
                     th:fragment="incharge-person-modal"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable modal-md">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="personModalLabel">Select Incharge Person</h5>
                                <button aria-label="Close" class="btn-close" data-bs-dismiss="modal"
                                        type="button"></button>
                            </div>
                            <div class="modal-body">
                                <label for="personSearch"></label><input type="text" id="personSearch"
                                                                         class="form-control mb-3"
                                                                         placeholder="Search by name..."
                                                                         autocomplete="off"/>
                                <ul id="personList" class="list-group">
                                    <li th:each="staff : ${staffs}" class="list-group-item list-group-item-action"
                                        th:text="${staff.name}" th:data-id="${staff.staffId}" style="cursor:pointer"
                                        onclick="selectIncharge(this)">
                                    </li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Support Member Modal -->
                <div aria-labelledby="memberModalLabel" class="modal fade" id="memberModal" tabindex="-1"
                     th:fragment="support-member-modal"
                     aria-hidden="true">
                    <div class="modal-dialog modal-dialog-scrollable modal-md">
                        <div class="modal-content">
                            <div class="modal-header">
                                <h5 class="modal-title" id="memberModalLabel">Add Support Member</h5>
                                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                            </div>
                            <div class="modal-body">
                                <label for="memberSearch"></label><input type="text" id="memberSearch"
                                                                         class="form-control mb-3"
                                                                         placeholder="Search member..."
                                                                         autocomplete="off"/>
                                <ul id="memberList" class="list-group mb-3">
                                    <li th:each="member : ${staffs}"
                                        class="list-group-item list-group-item-action"
                                        th:text="${member.name}"
                                        th:data-id="${member.staffId}"
                                        style="cursor:pointer"
                                        onclick="selectMember(this)">
                                    </li>
                                </ul>
                                <label for="monthSelect" class="form-label">Month</label>
                                <select id="monthSelect" name="monthSelect" class="form-select mb-3" required>
                                    <option value="" selected>--Select Month--</option>
                                    <option>January</option>
                                    <option>February</option>
                                    <option>March</option>
                                    <option>April</option>
                                    <option>May</option>
                                    <option>June</option>
                                    <option>July</option>
                                    <option>August</option>
                                    <option>September</option>
                                    <option>October</option>
                                    <option>November</option>
                                    <option>December</option>
                                </select>
                                <input type="hidden" id="selectedMember"/>
                                <button class="btn confirm w-100" id="addMemberBtn" type="button">Add Member
                                </button>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Step 2: Select Time Slots -->
                <div class="wizard-step" id="step2" th:fragment="time-slot-select">
                    <div class="d-flex justify-content-between mb-2">
                        <button class="btn cancel" id="prevWeekBtn" type="button"> ←
                            Previous Week
                        </button>
                        <button class="btn cancel" id="nextWeekBtn" type="button">
                            Next Week →
                        </button>
                    </div>
                    <table class="table table-bordered" id="timeSlotTable">
                        <thead>
                        <tr id="headerRow">
                            <th>Day</th>
                            <th colspan="2" class="col">Time Slots (hh:mm A)</th>
                            <th>Delete</th>
                        </tr>
                        </thead>
                        <tbody id="tableBody"></tbody>
                    </table>

                    <div class="d-flex justify-content-between mt-3">
                        <button class="btn cancel" onclick="goToStep(1)" style="width: 125px;" type="button">
                            Back
                        </button>
                        <button class="btn confirm" onclick="submitEvent()" style="width: 125px;" type="button">
                            Submit Event
                        </button>
                    </div>
                </div>
            </div>
        </form>
    </div>
</main>

<script th:src="@{/assets/vendor/bootstrap/js/bootstrap.bundle.min.js}"></script>
<script th:src="@{/js/event-calendar.js}"></script>
<script th:src="@{/js/commonUtility.js}"></script>
<div th:replace="~{fragments/footer :: footer}"></div>
<script th:src="@{/js/main.js}"></script>
<script th:src="@{/js/jquery.min.js}"></script>
<script th:src="@{/js/toast.min.js}"></script>

<script>
    var message = '[[${param.message}]]';
    var messageType = '[[${param.messageType}]]';

</script>

</body>
</html>
